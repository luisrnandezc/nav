{% load static %}

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>NAV | Bitácora</title>
        <link href="{% static 'dashboard.css' %}" rel="stylesheet" />
        <link href="{% static 'shared_components.css' %}" rel="stylesheet" />
        <link href="{% static 'fms_dashboard.css' %}" rel="stylesheet" />
        <script src="{% static 'js/load_more_flights.js' %}"></script>
    </head>

    <body>
        <div class="fms-container">
            <div class="back-button">
                <a href="{% url 'dashboard:dashboard' %}" class="button">&larr; Volver</a>
            </div>

            <div class="fms-header">
                <h1>Bitácora de Vuelo</h1>
                <p>Mis registros de vuelo y simulador</p>
            </div>

            <div class="sections-container">
                <!-- Instructor Statistics -->
                <div class="section">
                    <div class="section-header">
                        <h2>Estadísticas del Instructor de Vuelo</h2>
                    </div>
                    <div class="stats-details">
                        <div class="stat-detail-item">
                            <span class="detail-label">Total de Horas de Instrucción:</span>
                            <span class="detail-value">{{ total_flight_hours|floatformat:1 }} h</span>
                        </div>
                        <div class="stat-detail-item">
                            <span class="detail-label">Total de Combustible Consumido (Litros):</span>
                            <span class="detail-value">{{ total_consumed_liters|floatformat:1 }} l</span>
                        </div>
                        <div class="stat-detail-item">
                            <span class="detail-label">Total de Combustible Consumido (Galones):</span>
                            <span class="detail-value">{{ total_consumed_gallons|floatformat:1 }} gal</span>
                        </div>
                        <div class="stat-detail-item">
                            <span class="detail-label">FF total (Litros/h):</span>
                            <span class="detail-value">{{ fuel_rate_liters|floatformat:1 }} lph</span>
                        </div>
                        <div class="stat-detail-item">
                            <span class="detail-label">FF total (Galones/h):</span>
                            <span class="detail-value">{{ fuel_rate_gallons|floatformat:1 }} gph</span>
                        </div>
                    </div>
                </div>

                <!-- Evaluations 0-100 -->
                <div class="section">
                    <div class="section-header">
                        <h2>Evaluaciones 0-100h</h2>
                    </div>
                    <div class="flight-list" data-type="0_100" data-role="{{ user_role }}">
                        {% if latest_flight_0_100 %}
                            {% for session in latest_flight_0_100 %}
                                <a href="{% url 'fms:session_detail' '0_100' session.id %}" class="flight-item">
                                    <div class="flight-info">
                                        <span class="student-name">{{ session.student_first_name }} {{ session.student_last_name }}</span>
                                        <span class="session-grade {% if session.session_grade == 'S' or session.session_grade == 'SS' %}grade-s{% elif session.session_grade == 'NS' %}grade-ns{% elif session.session_grade == 'NE' %}grade-ne{% endif %}">{{ session.session_grade }}</span>
                                    </div>
                                    <div class="flight-details">
                                        <div class="detail-item">
                                            <span class="detail-label">Fecha:</span>
                                            <span class="detail-value">{{ session.session_date|date:"d/m/Y" }}</span>
                                        </div>
                                        <div class="detail-item">
                                            <span class="detail-label">Sesión:</span>
                                            <span class="detail-value">{{ session.session_number }}{% if session.session_letter %}{{ session.session_letter }}{% endif %}</span>
                                        </div>
                                        <div class="detail-item">
                                            <span class="detail-label">Aeronave:</span>
                                            <span class="detail-value">{{ session.aircraft.registration }}</span>
                                        </div>
                                        <div class="detail-item">
                                            <span class="detail-label">Horas:</span>
                                            <span class="detail-value">{{ session.session_flight_hours }}h</span>
                                        </div>
                                    </div>
                                </a>
                            {% endfor %}
                        {% else %}
                            <div class="no-flights">No hay evaluaciones 0-100h registradas</div>
                        {% endif %}
                    </div>
                    <button class="load-more-btn" data-type="0_100" data-role="{{ user_role }}" data-url="{% url 'fms:load_more_flights' %}">Cargar más</button>
                </div>

                <!-- Evaluations 100-120 -->
                <div class="section">
                    <div class="section-header">
                        <h2>Evaluaciones 100-120h</h2>
                    </div>
                    <div class="flight-list" data-type="100_120" data-role="{{ user_role }}">
                        {% if latest_flight_100_120 %}
                            {% for session in latest_flight_100_120 %}
                                <a href="{% url 'fms:session_detail' '100_120' session.id %}" class="flight-item">
                                    <div class="flight-info">
                                        <span class="student-name">{{ session.student_first_name }} {{ session.student_last_name }}</span>
                                        <span class="session-grade {% if session.session_grade == 'S' or session.session_grade == 'SS' %}grade-s{% elif session.session_grade == 'NS' %}grade-ns{% elif session.session_grade == 'NE' %}grade-ne{% endif %}">{{ session.session_grade }}</span>
                                    </div>
                                    <div class="flight-details">
                                        <div class="detail-item">
                                            <span class="detail-label">Fecha:</span>
                                            <span class="detail-value">{{ session.session_date|date:"d/m/Y" }}</span>
                                        </div>
                                        <div class="detail-item">
                                            <span class="detail-label">Sesión:</span>
                                            <span class="detail-value">{{ session.session_number }}{% if session.session_letter %}{{ session.session_letter }}{% endif %}</span>
                                        </div>
                                        <div class="detail-item">
                                            <span class="detail-label">Aeronave:</span>
                                            <span class="detail-value">{{ session.aircraft.registration }}</span>
                                        </div>
                                        <div class="detail-item">
                                            <span class="detail-label">Horas:</span>
                                            <span class="detail-value">{{ session.session_flight_hours }}h</span>
                                        </div>
                                    </div>
                                </a>
                            {% endfor %}
                        {% else %}
                            <div class="no-flights">No hay evaluaciones 100-120h registradas</div>
                        {% endif %}
                    </div>
                    <button class="load-more-btn" data-type="100_120" data-role="{{ user_role }}" data-url="{% url 'fms:load_more_flights' %}">Cargar más</button>
                </div>

                <!-- Evaluations 120-170 -->
                <div class="section">
                    <div class="section-header">
                        <h2>Evaluaciones 120-170h</h2>
                    </div>
                    <div class="flight-list" data-type="120_170" data-role="{{ user_role }}">
                        {% if latest_flight_120_170 %}
                            {% for session in latest_flight_120_170 %}
                                <a href="{% url 'fms:session_detail' '120_170' session.id %}" class="flight-item">
                                    <div class="flight-info">
                                        <span class="student-name">{{ session.student_first_name }} {{ session.student_last_name }}</span>
                                        <span class="session-grade {% if session.session_grade == 'S' or session.session_grade == 'SS' %}grade-s{% elif session.session_grade == 'NS' %}grade-ns{% elif session.session_grade == 'NE' %}grade-ne{% endif %}">{{ session.session_grade }}</span>
                                    </div>
                                    <div class="flight-details">
                                        <div class="detail-item">
                                            <span class="detail-label">Fecha:</span>
                                            <span class="detail-value">{{ session.session_date|date:"d/m/Y" }}</span>
                                        </div>
                                        <div class="detail-item">
                                            <span class="detail-label">Sesión:</span>
                                            <span class="detail-value">{{ session.session_number }}{% if session.session_letter %}{{ session.session_letter }}{% endif %}</span>
                                        </div>
                                        <div class="detail-item">
                                            <span class="detail-label">Aeronave:</span>
                                            <span class="detail-value">{{ session.aircraft.registration }}</span>
                                        </div>
                                        <div class="detail-item">
                                            <span class="detail-label">Horas:</span>
                                            <span class="detail-value">{{ session.session_flight_hours }}h</span>
                                        </div>
                                    </div>
                                </a>
                            {% endfor %}
                        {% else %}
                            <div class="no-flights">No hay evaluaciones 120-170h registradas</div>
                        {% endif %}
                    </div>
                    <button class="load-more-btn" data-type="120_170" data-role="{{ user_role }}" data-url="{% url 'fms:load_more_flights' %}">Cargar más</button>
                </div>

                <!-- Simulator Sessions -->
                <div class="section">
                    <div class="section-header">
                        <h2>Sesiones de Simulador</h2>
                    </div>
                    <div class="flight-list" data-type="sim" data-role="{{ user_role }}">
                        {% if latest_sim_sessions %}
                            {% for session in latest_sim_sessions %}
                                <a href="{% url 'fms:session_detail' 'sim' session.id %}" class="flight-item">
                                    <div class="flight-info">
                                        <span class="student-name">{{ session.student_first_name }} {{ session.student_last_name }}</span>
                                        <span class="session-grade {% if session.session_grade == 'S' or session.session_grade == 'SS' %}grade-s{% elif session.session_grade == 'NS' %}grade-ns{% elif session.session_grade == 'NE' %}grade-ne{% endif %}">{{ session.session_grade }}</span>
                                    </div>
                                    <div class="flight-details">
                                        <div class="detail-item">
                                            <span class="detail-label">Fecha:</span>
                                            <span class="detail-value">{{ session.session_date|date:"d/m/Y" }}</span>
                                        </div>
                                        <div class="detail-item">
                                            <span class="detail-label">Sesión:</span>
                                            <span class="detail-value">{{ session.session_number }}{% if session.session_letter %}{{ session.session_letter }}{% endif %}</span>
                                        </div>
                                        <div class="detail-item">
                                            <span class="detail-label">Simulador:</span>
                                            <span class="detail-value">{{ session.simulator.name }}</span>
                                        </div>
                                        <div class="detail-item">
                                            <span class="detail-label">Horas:</span>
                                            <span class="detail-value">{{ session.session_sim_hours }}h</span>
                                        </div>
                                    </div>
                                </a>
                            {% endfor %}
                        {% else %}
                            <div class="no-flights">No hay sesiones de simulador registradas</div>
                        {% endif %}
                    </div>
                    <button class="load-more-btn" data-type="sim" data-role="{{ user_role }}" data-url="{% url 'fms:load_more_flights' %}">Cargar más</button>
                </div>
            </div>
        </div>
    </body>
</html>
